<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stationed - London Underground Guessing Game</title>
    <meta name="description" content="Test your knowledge of London Underground stations" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #0a0a0f;
        --bg-secondary: #12121a;
        --bg-card: #1a1a24;
        --bg-hover: #22222e;
        --text-primary: #f5f5f7;
        --text-secondary: #8b8b9e;
        --text-muted: #5c5c6e;
        --accent: #6366f1;
        --accent-glow: rgba(99, 102, 241, 0.3);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --border: #2a2a3a;
        --border-light: #3a3a4a;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Header */
      .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        z-index: 100;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 16px var(--accent-glow);
      }

      .logo-text {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 24px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header-stats {
        display: flex;
        align-items: center;
        gap: 32px;
      }

      .stat {
        text-align: center;
      }

      .stat-label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        margin-bottom: 4px;
      }

      .stat-value {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .stat-value.accent {
        color: var(--accent);
      }

      /* Game Container */
      .game-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 73px);
        padding: 20px;
        gap: 20px;
      }

      /* Prompt Card */
      .prompt-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
        flex-wrap: wrap;
      }

      .prompt-content {
        flex: 1;
        min-width: 200px;
      }

      .prompt-label {
        font-size: 13px;
        color: var(--text-muted);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .round-badge {
        background: var(--bg-hover);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        color: var(--text-secondary);
      }

      .prompt-station {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .prompt-station .highlight {
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .prompt-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      /* Result Display */
      .result-display {
        display: none;
        align-items: center;
        gap: 16px;
        padding: 16px 24px;
        background: var(--bg-hover);
        border-radius: 12px;
        border: 1px solid var(--border-light);
      }

      .result-display.visible {
        display: flex;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-10px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .result-distance {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 20px;
        font-weight: 600;
      }

      .result-distance.excellent { color: var(--success); }
      .result-distance.good { color: var(--accent); }
      .result-distance.ok { color: var(--warning); }
      .result-distance.far { color: var(--danger); }

      .result-points {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .result-points span {
        color: var(--success);
        font-weight: 600;
      }

      /* Buttons */
      .btn {
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        font-weight: 600;
        padding: 14px 28px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        color: white;
        box-shadow: 0 4px 16px var(--accent-glow);
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 24px var(--accent-glow);
      }

      .btn-primary:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: var(--bg-hover);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      /* Map Container */
      .map-container {
        flex: 1;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid var(--border);
        position: relative;
        min-height: 400px;
      }

      #map {
        width: 100%;
        height: 100%;
        background: var(--bg-card);
      }

      .map-hint {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--bg-card);
        border: 1px solid var(--border);
        padding: 12px 24px;
        border-radius: 30px;
        font-size: 13px;
        color: var(--text-secondary);
        z-index: 1000;
        pointer-events: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: opacity 0.3s ease;
      }

      .map-hint.hidden {
        opacity: 0;
      }

      /* Game Over Screen */
      .game-over {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(10, 10, 15, 0.95);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .game-over.visible {
        display: flex;
        animation: fadeIn 0.4s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .game-over-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 24px;
        padding: 48px;
        text-align: center;
        max-width: 420px;
        width: 100%;
        animation: scaleIn 0.4s ease;
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .game-over-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        box-shadow: 0 8px 32px var(--accent-glow);
      }

      .game-over-title {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .game-over-subtitle {
        color: var(--text-secondary);
        margin-bottom: 32px;
      }

      .final-score {
        margin-bottom: 32px;
      }

      .final-score-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        margin-bottom: 8px;
      }

      .final-score-value {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 56px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .final-score-message {
        color: var(--text-secondary);
        margin-top: 8px;
      }

      /* Leaflet Overrides */
      .leaflet-container {
        background: var(--bg-card);
        font-family: 'Inter', sans-serif;
      }

      .leaflet-control-attribution {
        background: var(--bg-card) !important;
        color: var(--text-muted) !important;
        font-size: 10px !important;
        padding: 4px 8px !important;
      }

      .leaflet-control-attribution a {
        color: var(--accent) !important;
      }

      .leaflet-control-zoom {
        border: none !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
      }

      .leaflet-control-zoom a {
        background: var(--bg-card) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border) !important;
        width: 36px !important;
        height: 36px !important;
        line-height: 36px !important;
        font-size: 18px !important;
      }

      .leaflet-control-zoom a:hover {
        background: var(--bg-hover) !important;
      }

      .leaflet-control-zoom-in {
        border-radius: 8px 8px 0 0 !important;
      }

      .leaflet-control-zoom-out {
        border-radius: 0 0 8px 8px !important;
      }

      /* Custom Markers */
      .guess-marker {
        width: 24px;
        height: 24px;
        background: var(--accent);
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 12px var(--accent-glow);
      }

      .real-marker {
        width: 28px;
        height: 28px;
        background: var(--danger);
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 12px rgba(239, 68, 68, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header {
          padding: 12px 16px;
        }

        .logo-text {
          font-size: 20px;
        }

        .header-stats {
          gap: 20px;
        }

        .stat-value {
          font-size: 18px;
        }

        .game-container {
          padding: 12px;
          gap: 12px;
        }

        .prompt-card {
          padding: 16px 20px;
        }

        .prompt-station {
          font-size: 24px;
        }

        .btn {
          padding: 12px 20px;
          font-size: 13px;
        }

        .game-over-card {
          padding: 32px 24px;
        }

        .final-score-value {
          font-size: 44px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">üöá</div>
        <span class="logo-text">Stationed</span>
      </div>
      <div class="header-stats">
        <div class="stat">
          <div class="stat-label">Round</div>
          <div class="stat-value" id="round">1/10</div>
        </div>
        <div class="stat">
          <div class="stat-label">Score</div>
          <div class="stat-value accent" id="score">0</div>
        </div>
      </div>
    </header>

    <!-- Game Container -->
    <div class="game-container">
      <!-- Prompt Card -->
      <div class="prompt-card">
        <div class="prompt-content">
          <div class="prompt-label">
            <span>üìç Find this station</span>
            <span class="round-badge" id="round-badge">Round 1</span>
          </div>
          <h1 class="prompt-station">
            Where is <span class="highlight" id="station-name">Oxford Circus</span>?
          </h1>
        </div>
        <div class="prompt-actions">
          <div class="result-display" id="result-display">
            <div class="result-distance" id="result-distance">
              <span>üéØ</span>
              <span id="distance-value">245m</span>
            </div>
            <div class="result-points">
              <span id="points-earned">+850</span> points
            </div>
          </div>
          <button class="btn btn-primary" id="submit-btn" disabled>
            <span>üéØ</span>
            Submit Guess
          </button>
          <button class="btn btn-secondary" id="next-btn" style="display: none;">
            Next Round ‚Üí
          </button>
        </div>
      </div>

      <!-- Map -->
      <div class="map-container">
        <div id="map"></div>
        <div class="map-hint" id="map-hint">
          <span>üëÜ</span>
          Click anywhere on the map to place your guess
        </div>
      </div>
    </div>

    <!-- Game Over Screen -->
    <div class="game-over" id="game-over">
      <div class="game-over-card">
        <div class="game-over-icon">üèÜ</div>
        <h2 class="game-over-title">Game Complete!</h2>
        <p class="game-over-subtitle">You've guessed all 10 stations</p>
        <div class="final-score">
          <div class="final-score-label">Final Score</div>
          <div class="final-score-value" id="final-score">0</div>
          <p class="final-score-message" id="score-message">Keep exploring!</p>
        </div>
        <button class="btn btn-primary" id="play-again-btn" style="width: 100%; justify-content: center;">
          Play Again
        </button>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Station data
var stations = [
  { name: "Oxford Circus", lat: 51.515419, lng: -0.141099 },
  { name: "King's Cross St. Pancras", lat: 51.530663, lng: -0.123194 },
  { name: "Victoria", lat: 51.496424, lng: -0.144262 },
  { name: "Bank", lat: 51.513314, lng: -0.089039 },
  { name: "Liverpool Street", lat: 51.517372, lng: -0.083182 },
  { name: "Waterloo", lat: 51.503299, lng: -0.113387 },
  { name: "Paddington", lat: 51.515906, lng: -0.175579 },
  { name: "Euston", lat: 51.528083, lng: -0.133816 },
  { name: "London Bridge", lat: 51.505721, lng: -0.088557 },
  { name: "Leicester Square", lat: 51.511289, lng: -0.128324 },
  { name: "Piccadilly Circus", lat: 51.510067, lng: -0.133948 },
  { name: "Covent Garden", lat: 51.512947, lng: -0.124357 },
  { name: "Westminster", lat: 51.501402, lng: -0.124932 },
  { name: "Green Park", lat: 51.506947, lng: -0.142787 },
  { name: "Bond Street", lat: 51.514304, lng: -0.149536 },
  { name: "Tottenham Court Road", lat: 51.516426, lng: -0.130881 },
  { name: "Angel", lat: 51.532624, lng: -0.105898 },
  { name: "Old Street", lat: 51.525864, lng: -0.087807 },
  { name: "Moorgate", lat: 51.518705, lng: -0.088756 },
  { name: "Farringdon", lat: 51.520246, lng: -0.104899 },
  { name: "Barbican", lat: 51.520281, lng: -0.097755 },
  { name: "Russell Square", lat: 51.523096, lng: -0.124437 },
  { name: "Holborn", lat: 51.517423, lng: -0.120095 },
  { name: "Chancery Lane", lat: 51.518356, lng: -0.111491 },
  { name: "St. Paul's", lat: 51.515316, lng: -0.097471 },
  { name: "Mansion House", lat: 51.512139, lng: -0.094096 },
  { name: "Cannon Street", lat: 51.511264, lng: -0.090394 },
  { name: "Monument", lat: 51.510779, lng: -0.085978 },
  { name: "Tower Hill", lat: 51.510176, lng: -0.076548 },
  { name: "Aldgate", lat: 51.514246, lng: -0.075689 },
  { name: "Whitechapel", lat: 51.519518, lng: -0.059971 },
  { name: "Bethnal Green", lat: 51.527222, lng: -0.055437 },
  { name: "Mile End", lat: 51.525122, lng: -0.033382 },
  { name: "Stratford", lat: 51.541895, lng: -0.003671 },
  { name: "Canary Wharf", lat: 51.503542, lng: -0.018897 },
  { name: "North Greenwich", lat: 51.500338, lng: 0.003596 },
  { name: "Greenwich", lat: 51.477761, lng: -0.014596 },
  { name: "Brixton", lat: 51.462618, lng: -0.114888 },
  { name: "Stockwell", lat: 51.472154, lng: -0.122965 },
  { name: "Vauxhall", lat: 51.485743, lng: -0.124136 },
  { name: "Pimlico", lat: 51.489337, lng: -0.133653 },
  { name: "Sloane Square", lat: 51.492359, lng: -0.156519 },
  { name: "South Kensington", lat: 51.494094, lng: -0.173914 },
  { name: "Gloucester Road", lat: 51.494316, lng: -0.18275 },
  { name: "Earl's Court", lat: 51.491599, lng: -0.193373 },
  { name: "High Street Kensington", lat: 51.501076, lng: -0.191782 },
  { name: "Notting Hill Gate", lat: 51.509128, lng: -0.196104 },
  { name: "Bayswater", lat: 51.512268, lng: -0.187791 },
  { name: "Queensway", lat: 51.510312, lng: -0.187247 },
  { name: "Lancaster Gate", lat: 51.511717, lng: -0.175664 },
  { name: "Hammersmith", lat: 51.493558, lng: -0.224333 },
  { name: "Acton Town", lat: 51.503071, lng: -0.280303 },
  { name: "Ealing Broadway", lat: 51.514862, lng: -0.301971 },
  { name: "Turnham Green", lat: 51.495148, lng: -0.254555 },
  { name: "Gunnersbury", lat: 51.491357, lng: -0.275422 },
  { name: "Kew Gardens", lat: 51.47703, lng: -0.285039 },
  { name: "Richmond", lat: 51.463238, lng: -0.301558 },
  { name: "Wimbledon", lat: 51.421384, lng: -0.206512 },

  { name: "Clapham Common", lat: 51.461805, lng: -0.138311 },
  { name: "Clapham North", lat: 51.464843, lng: -0.129531 },
  { name: "Clapham South", lat: 51.452654, lng: -0.147582 },
  { name: "Balham", lat: 51.443293, lng: -0.152685 },
  { name: "Tooting Bec", lat: 51.435738, lng: -0.159736 },
  { name: "Tooting Broadway", lat: 51.42763, lng: -0.168374 },
  { name: "Colliers Wood", lat: 51.418008, lng: -0.177854 },
  { name: "Morden", lat: 51.402142, lng: -0.194839 },

  { name: "Camden Town", lat: 51.539292, lng: -0.142598 },
  { name: "Chalk Farm", lat: 51.544118, lng: -0.153388 },
  { name: "Hampstead", lat: 51.556821, lng: -0.17814 },
  { name: "Golders Green", lat: 51.572259, lng: -0.194039 },
  { name: "Brent Cross", lat: 51.576599, lng: -0.213606 },
  { name: "Edgware", lat: 51.613623, lng: -0.275276 },

  { name: "Finsbury Park", lat: 51.564635, lng: -0.106474 },
  { name: "Manor House", lat: 51.570759, lng: -0.09614 },
  { name: "Wood Green", lat: 51.597479, lng: -0.109886 },
  { name: "Arnos Grove", lat: 51.616446, lng: -0.133062 },

  { name: "Heathrow Terminal 5", lat: 51.47002, lng: -0.488176 },

  { name: "Cutty Sark", lat: 51.482902, lng: -0.009663 },
  { name: "Island Gardens", lat: 51.487095, lng: -0.010817 },
  { name: "Mudchute", lat: 51.491452, lng: -0.014281 },
  { name: "Poplar", lat: 51.507588, lng: -0.017394 },
  { name: "Bow Church", lat: 51.527316, lng: -0.020804 },
  { name: "Royal Victoria", lat: 51.509144, lng: 0.018124 }
];

      // Game state
      var currentStation = null;
      var guessMarker = null;
      var realMarker = null;
      var resultLine = null;
      var score = 0;
      var round = 1;
      var hasGuessed = false;
      var usedStations = [];

      // DOM elements
      var mapEl = document.getElementById("map");
      var submitBtn = document.getElementById("submit-btn");
      var nextBtn = document.getElementById("next-btn");
      var stationNameEl = document.getElementById("station-name");
      var roundEl = document.getElementById("round");
      var roundBadgeEl = document.getElementById("round-badge");
      var scoreEl = document.getElementById("score");
      var resultDisplay = document.getElementById("result-display");
      var resultDistance = document.getElementById("result-distance");
      var distanceValue = document.getElementById("distance-value");
      var pointsEarned = document.getElementById("points-earned");
      var mapHint = document.getElementById("map-hint");
      var gameOver = document.getElementById("game-over");
      var finalScore = document.getElementById("final-score");
      var scoreMessage = document.getElementById("score-message");
      var playAgainBtn = document.getElementById("play-again-btn");

      // Initialize map
      var map = L.map("map").setView([51.5074, -0.1278], 11);

      var noLabelsLayer = L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",
        { attribution: "&copy; OpenStreetMap & CARTO" }
      );

      var labelsLayer = L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
        { attribution: "&copy; OpenStreetMap & CARTO" }
      );

      noLabelsLayer.addTo(map);

      // Get random station
      function getRandomStation() {
        var available = stations.filter(function(s) {
          return usedStations.indexOf(s.name) === -1;
        });
        if (available.length === 0) {
          usedStations = [];
          available = stations;
        }
        var station = available[Math.floor(Math.random() * available.length)];
        usedStations.push(station.name);
        return station;
      }

      // Calculate score based on distance
      function calculateScore(distance) {
        if (distance < 50) return 1000;
        if (distance > 5000) return 0;
        return Math.round(1000 * Math.pow(0.9995, distance));
      }

      // Get distance class for styling
      function getDistanceClass(distance) {
        if (distance < 200) return "excellent";
        if (distance < 500) return "good";
        if (distance < 1000) return "ok";
        return "far";
      }

      // Format distance
      function formatDistance(distance) {
        if (distance < 1000) return distance + "m";
        return (distance / 1000).toFixed(1) + "km";
      }

      // Get score message
      function getScoreMessage(score) {
        if (score > 8000) return "You're a London expert! üèÜ";
        if (score > 6000) return "Impressive knowledge! üåü";
        if (score > 4000) return "Well done! üëè";
        if (score > 2000) return "Good effort! üëç";
        return "Keep exploring the Tube! üó∫Ô∏è";
      }

      // Start new round
      function startRound() {
        currentStation = getRandomStation();
        stationNameEl.textContent = currentStation.name;
        roundEl.textContent = round + "/10";
        roundBadgeEl.textContent = "Round " + round;
        
        submitBtn.disabled = true;
        submitBtn.style.display = "flex";
        nextBtn.style.display = "none";
        resultDisplay.classList.remove("visible");
        mapHint.classList.remove("hidden");
        hasGuessed = false;

        // Remove previous markers
        if (guessMarker) {
          map.removeLayer(guessMarker);
          guessMarker = null;
        }
        if (realMarker) {
          map.removeLayer(realMarker);
          realMarker = null;
        }
        if (resultLine) {
          map.removeLayer(resultLine);
          resultLine = null;
        }

        // Reset to no-labels layer
        map.removeLayer(labelsLayer);
        noLabelsLayer.addTo(map);
        map.setView([51.5074, -0.1278], 11);
      }

      // Handle map click
      map.on("click", function(e) {
        if (hasGuessed) return;

        if (guessMarker) {
          map.removeLayer(guessMarker);
        }

        var icon = L.divIcon({
          className: "custom-marker",
          html: '<div class="guess-marker"></div>',
          iconSize: [24, 24],
          iconAnchor: [12, 12]
        });

        guessMarker = L.marker(e.latlng, { icon: icon }).addTo(map);
        submitBtn.disabled = false;
        mapHint.classList.add("hidden");
      });

      // Submit guess
      submitBtn.addEventListener("click", function() {
        if (!guessMarker || hasGuessed) return;

        hasGuessed = true;
        var guessLatLng = guessMarker.getLatLng();
        var realLatLng = L.latLng(currentStation.lat, currentStation.lng);
        var distance = Math.round(realLatLng.distanceTo(guessLatLng));
        var roundScore = calculateScore(distance);

        score += roundScore;
        scoreEl.textContent = score.toLocaleString();

        // Show real location
        map.removeLayer(noLabelsLayer);
        labelsLayer.addTo(map);

        var realIcon = L.divIcon({
          className: "custom-marker",
          html: '<div class="real-marker">üìç</div>',
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        });

        realMarker = L.marker(realLatLng, { icon: realIcon }).addTo(map);

        // Draw line
        resultLine = L.polyline([guessLatLng, realLatLng], {
          color: "#ef4444",
          weight: 2,
          opacity: 0.7,
          dashArray: "8, 8"
        }).addTo(map);

        // Fit bounds
        var bounds = L.latLngBounds([guessLatLng, realLatLng]);
        map.fitBounds(bounds, { padding: [80, 80] });

        // Update UI
        distanceValue.textContent = formatDistance(distance);
        resultDistance.className = "result-distance " + getDistanceClass(distance);
        pointsEarned.textContent = "+" + roundScore;
        resultDisplay.classList.add("visible");

        submitBtn.style.display = "none";
        nextBtn.style.display = "flex";
      });

      // Next round
      nextBtn.addEventListener("click", function() {
        if (round >= 10) {
          // Game over
          finalScore.textContent = score.toLocaleString();
          scoreMessage.textContent = getScoreMessage(score);
          gameOver.classList.add("visible");
        } else {
          round++;
          startRound();
        }
      });

      // Play again
      playAgainBtn.addEventListener("click", function() {
        score = 0;
        round = 1;
        usedStations = [];
        scoreEl.textContent = "0";
        gameOver.classList.remove("visible");
        startRound();
      });

      // Start game
      startRound();
    </script>
  </body>
</html>
